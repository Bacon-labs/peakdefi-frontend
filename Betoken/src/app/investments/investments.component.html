<!-- HEADER -->
<div class="header">
  <div class="container-fluid px-md-5">
    <!-- Body -->
    <div class="header-body">
      <!-- Title -->
      <h1 class="header-title">
        Your Investments
      </h1>
    </div> <!-- / .header-body -->

  </div>
</div> <!-- / .header -->

<!-- CARDS -->
<div class="container-fluid pb-6 px-md-5">
  <div class="card-deck mb-5">
    <!-- Card -->
    <div class="card" data-toggle="tooltip" data-html="true" title="Amount of Betoken's AUM you manage. The more Kairo you own, the more money you will manage.">
      <div class="card-body">
        <div class="row align-items-center">
          <div class="col">
            <!-- Title -->
            <h6 class="card-title text-uppercase text-muted mb-2">
              Your Portfolio Value ($DAI)
            </h6>
            <!-- Heading -->
            <span class="h2 mb-0">
              {{portfolioValueInDAI}}
            </span>
          </div>
          <div class="col-auto">
            <!-- Icon -->
            <span class="h2 fe fe-pie-chart text-muted mb-0"></span>
          </div>
        </div> <!-- / .row -->

      </div>
    </div>
    <!-- Card -->
    <div class="card" data-toggle="tooltip" data-html="true" title="The more Kairo you own, the more money you will manage, the more commission you will receive. You can earn Kairo by making profitable investments for the Betoken fund.">
      <div class="card-body">
        <div class="row align-items-center">
          <div class="col">

            <!-- Title -->
            <h6 class="card-title text-uppercase text-muted mb-2">
              Your Kairo Balance
            </h6>

            <!-- Heading -->
            <span class="h2 mb-0">
              {{userValue}}
            </span>
            <!-- Badge -->
            <span class="badge" [ngClass]="{'badge-soft-success': monthly_pl.gte(0), 'badge-soft-danger': monthly_pl.lt(0)}">
              {{monthly_pl.toFormat(4)}}%
            </span>

          </div>
          <div class="col-auto">

            <!-- Icon -->
            <span class="h2 fe fe-zap text-muted mb-0"></span>

          </div>
        </div> <!-- / .row -->

      </div>
    </div>
    <!-- Card -->
    <div class="card" data-toggle="tooltip" data-html="true" title="The more Kairo you stake, the more of Betoken's money you put at work, the more commissions you earn.">
      <div class="card-body">
        <div class="row align-items-center">
          <div class="col">
            <div class="row no-gutters">
              <div class="col-auto">
                <!-- Title -->
                <h6 class="card-title text-uppercase text-muted mb-0">
                  Risk Taken
                </h6>
              </div>
              <div class="col-auto mt-n1">
                <a class="text-muted ml-2" href="https://betoken.gitbook.io/docs/manage-the-fund/how-does-risk-threshold-work" title="Learn more" target="_blank">
                  <span class="fe fe-help-circle"></span>
                </a>
              </div>
            </div>

            <div class="row align-items-center no-gutters">
              <div class="col-auto mb-2">

                <!-- Heading -->
                <span class="h2 mr-2 mb-0">
                  {{riskTakenPercentage.toFormat(2)}}%
                </span>

              </div>
              <div class="col-12">

                <!-- Progress -->
                <div class="progress progress-sm">
                  <div class="progress-bar" role="progressbar" [ngStyle]="{'width': riskTakenPercentage.toFormat(2) + '%'}" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100"></div>
                </div>

              </div>
            </div> <!-- / .row -->

          </div>
          <div class="col-auto">

            <!-- Icon -->
            <span class="h2 fe fe-database text-muted mb-0"></span>

          </div>
        </div> <!-- / .row -->

      </div>
    </div>
    <!-- Card -->
    <div class="card" data-toggle="tooltip" data-html="true" title="<strong>20%</strong> of the fund's profit and <strong>0.1%</strong> of the AUM is set aside as commissions every month, which is paid to managers proportional to the Kairo they hold. The estimate displayed here is calculated using the current fund ROI.">
      <div class="card-body">
        <div class="row align-items-center">
          <div class="col">

            <!-- Title -->
            <h6 class="card-title text-uppercase text-muted mb-2">
              Your Estimated Commission This Month ($DAI)
            </h6>

            <!-- Heading -->
            <span class="h2 mb-0">
              {{expected_commission}}
            </span>

          </div>
          <div class="col-auto">

            <!-- Icon -->
            <span class="h2 fe fe-award text-muted mb-0"></span>

          </div>
        </div> <!-- / .row -->

      </div>
    </div>
  </div> <!-- / .row -->
  <div class="row">
    <div class="col-12">
      <!-- Active trades -->
      <div class="card list-group">
        <div class="card-header list-group-item border-top-0 border-left-0 border-right-0">
          <div class="row align-items-center">
            <div class="col">
              <!-- Title -->
              <h4 class="mb-0">
                Active Investments
              </h4>
            </div>
            <div class="col-auto">
              <!-- Refresh -->
              <button class="btn btn-sm btn-white" type="button" name="button" (click) = "refresh()"><i class="fe fe-refresh-cw align-middle" *ngIf="isLoading() == false"></i><div class="loader loader-sm loader-secondary my-1" *ngIf="isLoading()"></div></button>
            </div>
          </div> <!-- / .row -->
        </div>
        <a class="list-group-item list-group-item-action border-bottom-0 border-left-0 border-right-0" href="#" data-toggle="modal" data-target="#modalSell" (click)="openSellModal(data)" *ngFor="let data of activeInvestmentList">
          <div class="row d-flex align-items-center no-gutters">
            <div class="col-auto">
              <span class="avatar avatar-xs">
                <img src={{getTokenLogoUrl(data.tokenSymbol)}} alt="{{data.tokenSymbol}} token logo" class="avatar-img rounded-circle">
              </span>
            </div>
            <div class="col pl-3">
              <div class="row d-flew align-items-center">
                <div class="col-auto pr-0">
                  <h4 class="mb-1 mb-lg-0">
                    {{data.tokenSymbol}}<span class="text-secondary d-none d-lg-inline-block ml-1 small font-weight-normal">• {{ (getTokenName(data.tokenSymbol).length>24)? (getTokenName(data.tokenSymbol) | slice:0:24)+'..':(getTokenName(data.tokenSymbol)) }}</span>
                  </h4>
                </div>
                <div class="col-12 col-lg-auto">
                  <span *ngIf="!isOrderOfType(data, 'basic')">
                    <span class="badge" [ngClass]="{'badge-soft-success': data.safety, 'badge-soft-danger': !data.safety}">
                      <span class="text-secondary" *ngIf="!data.orderType">Long {{data.leverage}}x</span><span class="text-secondary" *ngIf="data.orderType">Short {{data.leverage}}x</span> • <span *ngIf="data.safety">Safe</span><span *ngIf="!data.safety">In Danger</span>
                    </span>
                  </span>
                </div>
              </div>
            </div>
            <div class="col text-right">
              <div class="row d-flew align-items-center justify-content-end">
                <div class="col-12 col-lg-auto">
                  <span class="font-weight-bold">{{data.currValue.toFormat(4)}} KRO</span>
                </div>
                <div class="col-12 col-lg-auto">
                  <!-- Badge ROI -->
                  <span class="badge badge-xl" [ngClass]="{'badge-soft-success': data.ROI.gte(0), 'badge-soft-danger': data.ROI.lt(0)}">
                    {{data.ROI.toFormat(4)}}%
                  </span>
                </div>
              </div>
            </div>
          </div>
        </a>
        <div class="list-group-item justify-content-center text-center pt-5 border-0" *ngIf="activeInvestmentList.length == 0">
          <h3 class="mb-4">You have no active investments</h3>
          <button class="btn btn-success mb-5" routerLink="/investments" type="button" data-toggle="modal" data-target="#modalBuy" *ngIf="phase == 1">Make Investments</button>
          <img class="w-50 mx-auto d-block" src="assets/img/illustrations/undraw_empty_xct9.svg" alt="zero-state-illustration">
        </div>
      </div>
      <!-- Past Investments -->
      <div class="card list-group" *ngIf="inactiveInvestmentList.length > 0">
        <div class="card-header list-group-item border-top-0 border-left-0 border-right-0">
          <div class="row align-items-center">
            <div class="col">
              <!-- Title -->
              <h4 class="mb-0">
                Past Investments
              </h4>
            </div>
            <div class="col-auto">
              <!-- Refresh -->
              <button class="btn btn-sm btn-white" type="button" name="button" (click) = "refresh()"><i class="fe fe-refresh-cw align-middle" *ngIf="isLoading() == false"></i><div class="loader loader-sm loader-secondary my-1" *ngIf="isLoading()"></div></button>
            </div>
          </div> <!-- / .row -->
        </div>
        <div class="list-group-item border-bottom-0 border-left-0 border-right-0" *ngFor="let data of inactiveInvestmentList">
          <div class="row d-flex align-items-center no-gutters">
            <div class="col-auto">
              <span class="avatar avatar-xs">
                <img src={{getTokenLogoUrl(data.tokenSymbol)}} alt="{{data.tokenSymbol}} token logo" class="avatar-img rounded-circle">
              </span>
            </div>
            <div class="col pl-3">
              <div class="row d-flew align-items-center">
                <div class="col-auto pr-0">
                  <h4 class="mb-1 mb-lg-0">
                    {{data.tokenSymbol}}<span class="text-secondary d-none d-lg-inline-block ml-1 small font-weight-normal">• {{ (getTokenName(data.tokenSymbol).length>24)? (getTokenName(data.tokenSymbol) | slice:0:24)+'..':(getTokenName(data.tokenSymbol)) }}</span>
                  </h4>
                </div>
                <div class="col-12 col-lg-auto">
                  <span *ngIf="!isOrderOfType(data, 'basic')">
                    <span class="badge badge-soft-secondary" *ngIf="!data.orderType">Long {{data.leverage}}x</span><span class="badge badge-soft-secondary" *ngIf="data.orderType">Short {{data.leverage}}x</span>
                  </span>
                </div>
              </div>
            </div>
            <div class="col text-right">
              <div class="row d-flew align-items-center justify-content-end">
                <div class="col-12 col-lg-auto">
                  <span class="font-weight-bold">{{data.currValue.toFormat(4)}} KRO</span>
                </div>
                <div class="col-12 col-lg-auto">
                  <!-- Badge success -->
                  <span class="badge badge-xl badge-soft-success" *ngIf = "+data.ROI >= 0">
                    {{data.ROI.toFormat(4)}}%
                  </span>
                  <!-- Badge danger -->
                  <span class="badge badge-xl badge-soft-danger" *ngIf = "0 > +data.ROI">
                    {{data.ROI.toFormat(4)}}%
                  </span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div> <!-- / .row -->
  <a href="https://github.com/solidified-platform/audits/blob/master/Audit%20Report%20-%20%20Betoken%20%5B20.05.2019%5D.pdf" target="_blank">
    <div class="row align-items-center justify-content-center">
      <div class="col-auto mb-2 mb-lg-0">
        <div class="avatar avatar-sm">
          <img class="avatar-img rounded-circle bg-secondary" src="assets/img/solidified-logo.png" alt="Solidified logo">
        </div>
      </div>
      <div class="col-auto">
        <p class="small text-secondary mb-0 text-center">Betoken Smart Contracts are audited and secured by Solidified</p>
      </div>
      <div class="col-auto">
        <i class="fe fe-arrow-right text-secondary"></i>
      </div>
    </div>
  </a>
</div>


<!-- Buy modal -->
<div class="modal fade fixed-right" id="modalBuy" tabindex="-1" role="dialog" aria-labelledby="modalBuy" aria-hidden="true">
  <div class="modal-dialog modal-dialog-vertical bg-white" role="document">
    <div class="modal-content" data-toggle="lists" data-lists-values="[&quot;name&quot;]">
      <div class="modal-header border-0">
        <!-- Select Asset title -->
        <h4 class="modal-title" *ngIf="createInvestmentPopupStep === 0">
          Select An Asset
        </h4>
        <!-- Selected Asset title -->
        <a class="text-secondary" href="#/investments" (click)="resetModals()">
          <h4 class="modal-title d-flex align-items-center" *ngIf="createInvestmentPopupStep === 1">
            <i class="fe fe-arrow-left mr-2"></i>
            <span class="avatar avatar-xs align-middle mr-2">
              <img src={{getTokenLogoUrl(selectedTokenSymbol)}} alt="logo" class="avatar-img rounded-circle">
            </span>
            Buy {{getTokenName(selectedTokenSymbol)}}
          </h4>
        </a>
        <!-- Confirm asset investment title -->
        <h4 class="modal-title" *ngIf="createInvestmentPopupStep === 2">
          Confirm Investment
        </h4>
        <!-- Processing title -->
        <h4 class="modal-title" *ngIf="createInvestmentPopupStep === 3">
          Processing Investment
        </h4>
        <!-- Investment confirmed title -->
        <h4 class="modal-title" *ngIf="createInvestmentPopupStep === 4">
          Investment confirmed
        </h4>
        <!-- Close -->
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">×</span>
        </button>
      </div>
      <!-- progress bar buying -->
      <div class="card-header py-0 border-0" style="min-height: 24px;">
        <div class="progress" style="height: 8px;">
          <div [ngClass]="{'bg-success': createInvestmentPopupStep >= 0, 'bg-secondary': createInvestmentPopupStep !== 0}" class="progress-bar" role="progressbar" style="width: 20%" aria-valuenow="20" aria-valuemin="0" aria-valuemax="100"></div>
          <div [ngClass]="{'bg-success': createInvestmentPopupStep >= 1, 'bg-secondary': createInvestmentPopupStep !== 1}" class="progress-bar border-left" role="progressbar" style="width: 20%" aria-valuenow="20" aria-valuemin="0" aria-valuemax="100"></div>
          <div [ngClass]="{'bg-success': createInvestmentPopupStep >= 2, 'bg-secondary': createInvestmentPopupStep !== 2}" class="progress-bar border-left" role="progressbar" style="width: 20%" aria-valuenow="20" aria-valuemin="0" aria-valuemax="100"></div>
          <div [ngClass]="{'bg-success': createInvestmentPopupStep >= 3, 'bg-secondary': createInvestmentPopupStep !== 3}" class="progress-bar border-left" role="progressbar" style="width: 20%" aria-valuenow="20" aria-valuemin="0" aria-valuemax="100"></div>
          <div [ngClass]="{'bg-success': createInvestmentPopupStep >= 4, 'bg-secondary': createInvestmentPopupStep !== 4}" class="progress-bar border-left" role="progressbar" style="width: 20%" aria-valuenow="20" aria-valuemin="0" aria-valuemax="100"></div>
        </div>
      </div>
      <!-- Search in list assets -->
      <div class="card-header" *ngIf="createInvestmentPopupStep === 0">
        <form>
          <div class="input-group input-group-flush input-group-merge">
            <input type="search" class="form-control form-control-prepended search" placeholder="Search" (keyup)="filterList($event, 'asset-list', 0)">
            <div class="input-group-prepend">
              <div class="input-group-text">
                <span class="fe fe-search"></span>
              </div>
            </div>
          </div>
        </form>
      </div>
      <div class="modal-body">
        <!-- Step 0: select asset -->
        <ul class="list-group list-group-flush list" id="asset-list" *ngIf="createInvestmentPopupStep === 0">
          <li class="list-group-item px-0" *ngFor = "let token of tokenData">
            <a class="text-secondary" href="#/investments" (click)="selectInvestmentAsset(token.symbol)">
              <div class="row align-items-center">
                <div class="col-auto">
                  <span class="avatar avatar-sm">
                    <img src={{token.logoUrl}} alt="token logo" class="avatar-img rounded-circle">
                  </span>
                </div>
                <div class="col ml-n2 pl-1">
                  <span class="mb-1 h4 font-weight-bold">
                    {{token.symbol}}
                    <span class="badge badge-soft-primary" *ngIf="isMarginToken(token.symbol)" style="font-size:10px;">
                      Margin Trading
                    </span>
                  </span>
                  <p class="small mb-0">
                    {{token.name}}
                  </p>
                </div>
                <div class="col-auto text-right">

                  <span>{{token.price.dp(4)}} DAI</span>
                  <br>

                  <span class="badge badge-xl" [ngClass]="{'badge-soft-success': +getTokenDailyPriceChange(token.symbol) >= 0, 'badge-soft-danger': 0 > +getTokenDailyPriceChange(token.symbol)}">
                    {{getTokenDailyPriceChange(token.symbol)}}%
                  </span>

                </div>
              </div>

            </a>
          </li>
        </ul>

        <!-- Step 1: enter stake amount -->
        <div *ngIf="createInvestmentPopupStep === 1">
          <!-- Asset price -->
          <div class="row">

            <div class="col">
              <h6 class="header-pretitle">
                Current price in DAI
              </h6>
              <h4 class="mb-0">
                {{assetSymbolToPrice(selectedTokenSymbol).dp(10)}}
              </h4>
            </div>
            <div class="col">
              <h6 class="header-pretitle mb-2">
                24h change
              </h6>
              <span class="badge" [ngClass]="{'badge-soft-success': +getTokenDailyPriceChange(selectedTokenSymbol) >= 0, 'badge-soft-danger': 0 > +getTokenDailyPriceChange(selectedTokenSymbol)}">
                {{getTokenDailyPriceChange(selectedTokenSymbol)}}%
              </span>
            </div>
          </div>
          <hr class="my-4" >

          <!-- KRO amount to stake -->
          <h6 class="header-pretitle">I want to buy {{getTokenName(selectedTokenSymbol)}} by staking</h6>
          <div class="row justify-content-center">
            <div class="col">
              <form>
                <div class="input-group mb-2">
                  <input type="number" min="0.0" max={{kairo_balance.toFormat(18)}} class="form-control form-control-lg" aria-describedby="KRO Token Amount to stake" placeholder="0.0 KRO" id="kairo-input" (input)="continueEnabled = true">
                  <div class="input-group-append">
                    <button class="btn btn-white" name="button" type="button" (click)="maxStake()">Max</button>
                  </div>
                </div>
                <small id="kroBalance" class="form-text text-secondary d-inline-block mb-0 mt-2">{{kairo_balance.toFormat(18)}} KRO available</small>
                <h6 class="header-pretitle mt-4" *ngIf="isMarginToken(selectedTokenSymbol)">Order type</h6>
                <select class="form-control form-control-lg" id="orderTypeSelect" (change)="selectOrderType($event.target.selectedIndex)" *ngIf="isMarginToken(selectedTokenSymbol)">
                  <option *ngFor="let orderType of orderTypes">{{orderType.text}}</option>
                </select>
              </form>
            </div>
          </div>

          <!-- Max acceptable price -->
          <div class="row justify-content-center">
            <div class="col">
              <div id="accordion">
                <!-- question -->
                <div class="card border-0 shadow-none mb-0">
                  <div class="card-header border-0 shadow-none px-0" id="headingOne">
                    <a href="" class="text-secondary" data-toggle="collapse" data-target="#collapseOne" aria-expanded="false" aria-controls="collapseOne">
                      <div class="row align-items-center no-gutters">
                        <div class="col mr-auto">
                          <span class="card-text text-muted small">
                            Advanced
                          </span>
                        </div>
                        <div class="col-auto">
                          <i class="fe fe-plus"></i>
                        </div>
                      </div>
                    </a>
                  </div>
                  <div id="collapseOne" class="collapse" aria-labelledby="headingOne" data-parent="#accordion">
                    <div class="card-body p-0 pb-4">
                      <div class="row align-items-center">
                        <div class="col">
                          <h6 class="header-pretitle">
                            Max acceptable price
                          </h6>
                          <p>Your order <strong>won't</strong> be executed if the price goes up by more than:</p>
                          <form>
                            <div class="input-group input-group-lg">
                              <input type="number" class="form-control border-right-0" aria-describedby="maxAcceptablePrice" placeholder="0.0" value="10" id="maxAcceptablePrice">
                              <div class="input-group-append">
                                <span class="input-group-text rounded-right border-left-0" id="maxAcceptablePriceUnit">%</span>
                              </div>
                            </div>
                          </form>
                        </div>
                      </div>

                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- All the components below are displayed if leveraged or shorted order option is selected -->
          <div *ngIf="isMarginToken(selectedTokenSymbol) && selectedOrderType.type !== 'basic'">
            <hr class="mb-4 mt-0">

            <!-- order details -->
            <div class="card card-inactive my-4">
              <div class="card-body">
                <!-- Payout -->
                <h6 class="header-pretitle">
                  Payout
                </h6>
                <p>This order <strong>multiplies your returns by {{selectedOrderType.leverage}}x</strong>.</p>
                <!-- IDEA: leveraged order -->
                <p>If {{selectedTokenSymbol}}'s price <span class="text-success">+10%</span>, you <span class="text-success" *ngIf="selectedOrderType.leverage > 0">gain {{10 * selectedOrderType.leverage}}%</span> <span class="text-danger" *ngIf="0 > selectedOrderType.leverage">lose {{-10 * selectedOrderType.leverage}}%</span>.</p>
                <p>If {{selectedTokenSymbol}}'s price <span class="text-danger">-10%</span>, you <span class="text-danger" *ngIf="selectedOrderType.leverage > 0">lose {{10 * selectedOrderType.leverage}}%</span> <span class="text-success" *ngIf="0 > selectedOrderType.leverage">gain {{-10 * selectedOrderType.leverage}}%</span>.</p>

                <h6 class="header-pretitle">Liquidation</h6>
                <p>
                  This order could be liquidated if its losses exceed a certain threshold (which will be displayed). If that happens, a large portion of your stake will be lost. <a href="https://betoken.gitbook.io/docs/manage-the-fund/what-would-cause-a-position-of-mine-to-get-liquidated" target="_blank">Learn More</a>
                </p>
              </div>
            </div>
          </div>
        </div>

        <!-- Step 2: confirm transaction -->
        <p class="text-center text-muted mb-5" *ngIf="createInvestmentPopupStep === 2">
          Confirm the transaction in your wallet’s interface to save it on the Ethereum blockchain. It's fine to stick with these defaults gas limit and price.
        </p>

        <!-- Step 3: transaction broadcasted -->
        <!-- Processing investment body -->
        <img class="image-fluid d-block mx-auto mb-4" src="assets/img/animated-logo.svg" alt="Betoken logo" style="width: 88px;" *ngIf="createInvestmentPopupStep === 3">
        <p class="text-center text-muted mb-5" *ngIf="createInvestmentPopupStep === 3">
          Your investment is being saved on the Ethereum blockchain.
        </p>

        <!-- Step 4: transaction confirmed -->
        <!-- Investment confirmed body -->
        <div *ngIf="createInvestmentPopupStep === 4">
          <p class="h1 text-center">
            <i class="fe fe-check-circle text-success"></i>
          </p>
          <p class="text-center text-muted mb-5">
            You staked <span class="font-weight-bold text-secondary">{{stakeAmount}}</span> KRO to invest in <span class="font-weight-bold text-secondary">{{getTokenName(selectedTokenSymbol)}}</span>.
          </p>

        </div>

        <!-- Transaction hash display for steps 3 & 4 -->
        <hr *ngIf="createInvestmentPopupStep === 3 || createInvestmentPopupStep === 4">
        <form *ngIf="createInvestmentPopupStep === 3 || createInvestmentPopupStep === 4">
          <div class="form-group">
            <label for="exampleFormControlInput1">Transaction ID</label>
            <div class="input-group mb-3">
              <input type="text" class="form-control form-control-lg" value="{{transactionId}}" aria-label="Transaction ID" aria-describedby="">
              <div class="input-group-append">
                <a class="btn btn-white h-100 d-flex align-items-center" href="https://etherscan.io/tx/{{transactionId}}" target="_blank"><i class="fe fe-external-link"></i></a>
              </div>
            </div>
          </div>
        </form>

        <!-- Continue button for step 1 -->
        <button type="submit" class="btn btn-block btn-success mt-auto" aria-label="Invest" (click)="createInvestment()" *ngIf="createInvestmentPopupStep === 1" [disabled]="!continueEnabled">
          Continue
        </button>
        <!-- Close button for step 3 -->
        <button type="submit" class="btn btn-block btn-white mt-auto" data-dismiss="modal" aria-label="Close" *ngIf="createInvestmentPopupStep === 3">
          Close
        </button>
        <!-- Close button for step 4 -->
        <button type="submit" class="btn btn-block btn-white mt-auto" data-dismiss="modal" aria-label="Close" *ngIf="createInvestmentPopupStep === 4">
          Close
        </button>
      </div>
    </div>
  </div>
</div><!-- / modal -->

<!-- Sell modal -->
<div class="modal fade fixed-right" id="modalSell" tabindex="-1" role="dialog" aria-labelledby="modalSell" aria-hidden="true">
  <div class="modal-dialog modal-dialog-vertical bg-white" role="document">
    <div class="modal-content">
      <div class="modal-header border-0">
        <!-- Quantity of asset to sell title -->
        <h4 class="modal-title" *ngIf="sellInvestmentPopupStep === 0">
          <span class="align-items-center">
            <span class="avatar avatar-xs align-middle mr-2">
              <img src={{getTokenLogoUrl(selectedTokenSymbol)}} alt="logo" class="avatar-img rounded-circle">
            </span>
            {{selectedTokenSymbol}}
            <span class="text-secondary ml-2" *ngIf="!isOrderOfType(sellData, 'basic')">
              <span *ngIf="!sellData.orderType">Long</span><span *ngIf="sellData.orderType">Short</span> • Leverage {{sellData.leverage}}x
            </span>
          </span>
        </h4>
        <!-- Confirm asset investment title -->
        <h4 class="modal-title" *ngIf="sellInvestmentPopupStep === 1">
          Confirm sell order
        </h4>
        <!-- Processing title -->
        <h4 class="modal-title" *ngIf="sellInvestmentPopupStep === 2">
          Processing sell order
        </h4>
        <!-- Sell order confirmed title -->
        <h4 class="modal-title" *ngIf="sellInvestmentPopupStep === 3">
          Sell order confirmed
        </h4>
        <!-- Close -->
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">×</span>
        </button>
      </div>
      <!-- progress bar selling -->
      <div class="card-header py-0 border-0" style="min-height: 24px;">
        <div class="progress" style="height: 8px;">
          <div [ngClass]="{'bg-success': sellInvestmentPopupStep >= 0, 'bg-secondary': sellInvestmentPopupStep !== 0}" class="progress-bar bg-success" role="progressbar" style="width: 25%" aria-valuenow="25" aria-valuemin="0" aria-valuemax="100"></div>
          <div [ngClass]="{'bg-success': sellInvestmentPopupStep >= 1, 'bg-secondary': sellInvestmentPopupStep !== 1}" class="progress-bar border-left" role="progressbar" style="width: 25%" aria-valuenow="25" aria-valuemin="0" aria-valuemax="100"></div>
          <div [ngClass]="{'bg-success': sellInvestmentPopupStep >= 2, 'bg-secondary': sellInvestmentPopupStep !== 2}" class="progress-bar border-left" role="progressbar" style="width: 25%" aria-valuenow="25" aria-valuemin="0" aria-valuemax="100"></div>
          <div [ngClass]="{'bg-success': sellInvestmentPopupStep >= 3, 'bg-secondary': sellInvestmentPopupStep !== 3}" class="progress-bar border-left" role="progressbar" style="width: 25%" aria-valuenow="25" aria-valuemin="0" aria-valuemax="100"></div>
        </div>
      </div>

      <div class="modal-body pb-5">
        <!--Step 0: enter sell amount-->
        <time class="header-pretitle h6 mb-0" *ngIf="sellInvestmentPopupStep === 0">OPENED {{sellData.buyTime.toLocaleString()}}</time>
        <hr class="mb-4" *ngIf="sellInvestmentPopupStep === 0">
        <!-- Asset price -->
        <div class="row mb-4" *ngIf="sellInvestmentPopupStep === 0">
          <div class="col">
            <h6 class="header-pretitle">
              Current price in DAI
            </h6>
            <h4 class="mb-0">
              {{assetSymbolToPrice(selectedTokenSymbol)}}
            </h4>
          </div>
          <div class="col">
            <h6 class="header-pretitle mb-1">
              ROI
            </h6>
            <span class="badge" [ngClass]="{'badge-soft-success': sellData.ROI.gte(0), 'badge-soft-danger': sellData.ROI.lt(0)}">
              {{sellData.ROI.toFormat(4)}}%
            </span>
          </div>
        </div>
        <div class="row" *ngIf="sellInvestmentPopupStep === 0">
          <div class="col">
            <h6 class="header-pretitle">
              Staked KRO
            </h6>
            <h4 class="mb-0">
              {{sellData.stake.toFormat(4)}}
            </h4>
          </div>
          <div class="col">
            <h6 class="header-pretitle">
              KRO to Redeem
            </h6>
            <h4 class="mb-0">
              {{sellData.currValue.toFormat(4)}}
            </h4>
          </div>
        </div>
        <div *ngIf="sellInvestmentPopupStep === 0">
          <div class="row my-4" *ngIf="isOrderOfType(sellData, 'fulcrum')">
            <div class="col">
              <h6 class="header-pretitle">
                Margin Position Price
              </h6>
              <h4 class="mb-0">
                {{sellData.sellPrice.toFormat(4)}}
                <span class="badge badge-soft-success ml-1" *ngIf="sellData.safety">
                  Safe
                </span>
                <span class="badge badge-soft-danger ml-1" *ngIf="!sellData.safety">
                  In Danger
                </span>
              </h4>
            </div>
            <div class="col">
              <h6 class="header-pretitle">
                Liquidation Price
              </h6>
              <h4 class="mb-0">
                {{sellData.liquidationPrice.toFormat(4)}}
              </h4>
            </div>
          </div>
          <div class="row" *ngIf="isOrderOfType(sellData, 'fulcrum')">
            <div class="col">
              <p class="text-secondary small mb-0">If the margin position price falls below the liquidation price, this order will be liquidated, which will cause huge losses. When the order is in danger of liquidation, sell it.</p>
            </div>
          </div>
        </div>

        <div *ngIf="isOrderOfType(sellData, 'compound')">
          <div class="row align-items-center justify-content-center mt-4 mb-3">
            <div class="col">
              <h6 class="header-pretitle mb-0">
                Collateralization status
              </h6>
            </div>
            <div class="col-auto d-flex align-items-center">
              <a href="" class="btn btn-sm btn-white" data-toggle="modal" data-target="#modalTopUp">Top up</a>
            </div>
          </div>
          <div class="row align-items-center">
            <div class="col">
              <span class="badge badge-soft-success mb-2" *ngIf="sellData.safety">
                Safe
              </span>
              <span class="badge badge-soft-danger mb-2" *ngIf="!sellData.safety">
                In Danger
              </span>
              <div class="progress">
                <div [ngClass]="{'bg-success': sellData.safety, 'bg-danger': !sellData.safety}" class="progress-bar" role="progressbar" [ngStyle]="{'width': sellData.collateralRatio.div(sellData.minCollateralRatio.times(2)).times(100).toFormat(2) + '%'}">{{sellData.collateralRatio.times(100).toFormat(0)}}%</div>
              </div>
              <div class="row no-gutters justify-content-between text-secondary mb-3">
                <div class="col text-left">
                  <small class="h6">0%</small>
                  <small class="h6 d-block">Unsafe</small>
                </div>
                <div class="col text-left position-absolute d-block w-auto" style="left: 49.0000%;transform: translateX(-50%);">
                  <div style="display: flex; flex-direction: column;">
                    <div style="border: 0.5px dashed #6e84a3; width: 1px; height: 8px; align-self: center;"></div>
                    <small class="h6">{{sellData.minCollateralRatio.times(100).toFormat(0)}}% • min. collateral ratio</small>
                  </div>
                </div>
                <div class="col text-right">
                  <small class="h6">{{sellData.minCollateralRatio.times(2).times(100).toFormat(0)}}%</small>
                  <small class="h6 d-block">Safe</small>
                </div>
              </div>
              <p class="text-secondary small mb-0">If the order's collateral ratio falls below the minimum, it will be liquidated, which will cause huge losses.</p>
            </div>
          </div>
        </div>
        <div *ngIf="sellInvestmentPopupStep === 0">
          <hr class="my-4">
          <div *ngIf="isOrderOfType(sellData, 'basic') || isOrderOfType(sellData, 'fulcrum')">
            <!-- KRO amount to unstake -->
            <!-- hideen when top up feature is activated -->
            <h6 class="header-pretitle">Proportion of assets to sell</h6>
            <div class="row">
              <div class="col">
                <form>
                  <div class="input-group mb-2">
                    <input type="number" min="0.0" max="100.0" class="form-control form-control-lg border-right-0 pr-0" aria-describedby="percent of stake to sell" placeholder="0.0" id="sell-percentage-input" (input)="continueEnabled = true">
                    <div class="input-group-append">
                      <span class="input-group-text border-left-0 border-right-0" id="maxSellPercentUnit">%</span>
                      <button class="btn btn-white" name="button" type="button" (click)="maxSellPercent()">Max</button>
                    </div>
                  </div>
                </form>
              </div>
            </div>
          </div>
          <!-- Min acceptable price -->
          <div class="row justify-content-center mb-4">
            <div class="col">
              <div id="accordion">
                <!-- question -->
                <div class="card border-0 shadow-none mb-0">
                  <div class="card-header border-0 shadow-none px-0" id="headingTwo">
                    <a href="" class="text-secondary" data-toggle="collapse" data-target="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo">
                      <div class="row align-items-center no-gutters">
                        <div class="col mr-auto">
                          <span class="card-text text-muted small">
                            Advanced
                          </span>
                        </div>
                        <div class="col-auto">
                          <i class="fe fe-plus"></i>
                        </div>
                      </div>
                    </a>
                  </div>
                  <div id="collapseTwo" class="collapse" aria-labelledby="headingTwo" data-parent="#accordion">
                    <div class="card-body p-0 pb-4">
                      <div class="row align-items-center">
                        <div class="col">
                          <h6 class="header-pretitle">
                            Min acceptable price
                          </h6>
                          <p>Your order <strong>won't</strong> be executed if the price goes down by more than:</p>
                          <form>
                            <div class="input-group input-group-lg">
                              <input type="number" min="0.0" max="100.0" class="form-control border-right-0" aria-describedby="minAcceptablePrice" placeholder="0.0" value="10" id="minAcceptablePrice">
                              <div class="input-group-append">
                                <span class="input-group-text rounded-right border-left-0" id="minAcceptablePriceUnit">%</span>
                              </div>
                            </div>
                          </form>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <!--Step 1: confirm tx in wallet-->
        <!-- Confirm tx body -->
        <p class="text-center text-muted mb-5" *ngIf="sellInvestmentPopupStep === 1">
          Confirm the transaction in your wallet’s interface to save it on the Ethereum blockchain. It's fine to stick with these defaults gas limit and price.
        </p>

        <!--Step 2: tx broadcasted-->
        <!-- loader -->
        <img class="image-fluid d-block mx-auto mb-4" src="assets/img/animated-logo.svg" alt="Betoken logo" style="width: 88px;" *ngIf="sellInvestmentPopupStep === 2">
        <!-- Tx broadcasted body -->
        <p class="text-center text-muted mb-5" *ngIf="sellInvestmentPopupStep === 2">
          Your transaction is being saved on the Ethereum blockchain. You can check its status on Etherscan.
        </p>

        <!--Step 3: tx confirmed-->
        <!-- Asset sold body -->
        <p class="h1 text-center" *ngIf="sellInvestmentPopupStep === 3">
          <i class="fe fe-check-circle text-success"></i>
        </p>
        <p class="text-center text-muted mb-5" *ngIf="sellInvestmentPopupStep === 3">
          You have successfully sold the investment and redeemed your Kairo.
        </p>
        <hr *ngIf="sellInvestmentPopupStep === 2 || sellInvestmentPopupStep === 3">
        <form *ngIf="sellInvestmentPopupStep === 2 || sellInvestmentPopupStep === 3">
          <div class="form-group">
            <label for="exampleFormControlInput1">Transaction ID</label>
            <div class="input-group mb-3">
              <input type="text" class="form-control form-control-lg" value="{{transactionId}}" aria-label="Transaction ID" aria-describedby="">
              <div class="input-group-append">
                <a class="btn btn-white h-100 d-flex align-items-center" href="https://etherscan.io/tx/{{transactionId}}" target="_blank"><i class="fe fe-external-link"></i></a>
              </div>
            </div>
          </div>
        </form>

        <!-- Continue button for amount to sell Step -->
        <button type="submit" class="btn btn-block btn-success mt-auto" aria-label="Sell" (click)="sell()" *ngIf="sellInvestmentPopupStep === 0" [disabled]="!continueEnabled && (isOrderOfType(sellData, 'basic') || isOrderOfType(sellData, 'fulcrum'))">
          Sell Investment
        </button>
        <!-- close button panel after Asset being sold -->
        <button type="submit" class="btn btn-block btn-white mt-auto" data-dismiss="modal" aria-label="Close" *ngIf="sellInvestmentPopupStep === 3">
          Close
        </button>

      </div>
    </div>
  </div>
</div><!-- / modal -->

<!-- Top up collateralization modal -->
<div class="modal fade fixed-right" id="modalTopUp" tabindex="-1" role="dialog" aria-labelledby="modalTopUp" aria-hidden="true" *ngIf="sellData['type'] === 'compound'">
  <div class="modal-dialog modal-dialog-vertical bg-white" role="document">
    <div class="modal-content">
      <div class="modal-header border-0">
        <!-- Collateralization target title -->
        <h4 class="modal-title" *ngIf="topupPopupStep == 0">
          Top up your order
        </h4>
        <!-- Confirm top up title -->
        <h4 class="modal-title" *ngIf="topupPopupStep == 1">
          Confirm top up order
        </h4>
        <!-- Processing top up title -->
        <h4 class="modal-title" *ngIf="topupPopupStep == 2">
          Processing top up order
        </h4>
        <!-- Top up order confirmed title -->
        <h4 class="modal-title" *ngIf="topupPopupStep == 3">
          Top up confirmed
        </h4>
        <!-- Close -->
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">×</span>
        </button>
      </div>
      <!-- progress bar selling -->
      <div class="card-header py-0 border-0" style="min-height: 24px;">
        <div class="progress" style="height: 8px;">
          <div [ngClass]="{'bg-success': topupPopupStep >= 0, 'bg-secondary': topupPopupStep !== 0}" class="progress-bar bg-success" role="progressbar" style="width: 25%" aria-valuenow="25" aria-valuemin="0" aria-valuemax="100"></div>
          <div [ngClass]="{'bg-success': topupPopupStep >= 1, 'bg-secondary': topupPopupStep !== 1}" class="progress-bar border-left" role="progressbar" style="width: 25%" aria-valuenow="25" aria-valuemin="0" aria-valuemax="100"></div>
          <div [ngClass]="{'bg-success': topupPopupStep >= 2, 'bg-secondary': topupPopupStep !== 2}" class="progress-bar border-left" role="progressbar" style="width: 25%" aria-valuenow="25" aria-valuemin="0" aria-valuemax="100"></div>
          <div [ngClass]="{'bg-success': topupPopupStep >= 3, 'bg-secondary': topupPopupStep !== 3}" class="progress-bar border-left" role="progressbar" style="width: 25%" aria-valuenow="25" aria-valuemin="0" aria-valuemax="100"></div>
        </div>
      </div>

      <div class="modal-body pb-5">
        <!--Step 0: enter top up amount-->
        <div *ngIf="topupPopupStep == 0">
          <div class="row align-items-center justify-content-center mb-3">
            <div class="col">
              <h6 class="header-pretitle mb-0">
                Collateralization status
              </h6>
            </div>
          </div>
          <div class="row align-items-center">
            <div class="col">
              <span class="badge badge-soft-success mb-2" *ngIf="sellData.safety">
                Safe
              </span>
              <span class="badge badge-soft-danger mb-2" *ngIf="!sellData.safety">
                In Danger
              </span>
              <div class="progress">
                <div [ngClass]="{'bg-success': sellData.safety, 'bg-danger': !sellData.safety}" class="progress-bar" role="progressbar" [ngStyle]="{'width': sellData.collateralRatio.div(sellData.minCollateralRatio.times(2)).times(100).toFormat(2) + '%'}">{{sellData.collateralRatio.times(100).toFormat(0)}}%</div>
              </div>
              <div class="row no-gutters justify-content-between text-secondary mb-3">
                <div class="col text-left">
                  <small class="h6">0%</small>
                  <small class="h6 d-block">Unsafe</small>
                </div>
                <div class="col text-left position-absolute d-block w-auto" style="left: 49.0000%;transform: translateX(-50%);">
                  <div style="display: flex; flex-direction: column;">
                    <div style="border: 0.5px dashed #6e84a3; width: 1px; height: 8px; align-self: center;"></div>
                    <small class="h6">{{sellData.minCollateralRatio.times(100).toFormat(0)}}% • min. collateral ratio</small>
                  </div>
                </div>
                <div class="col text-right">
                  <small class="h6">{{sellData.minCollateralRatio.times(2).times(100).toFormat(0)}}%</small>
                  <small class="h6 d-block">Safe</small>
                </div>
              </div>
              <p class="text-secondary small mb-0">If the order's collateral ratio falls below the minimum, it will be liquidated, which will cause huge losses.</p>
            </div>
          </div>

          <hr class="my-4">

          <!-- Collateralization target -->
          <h6 class="header-pretitle">Collateralization target</h6>
          <div class="row mb-4">
            <div class="col">
              <form>
                <div class="input-group mb-2">
                  <input type="number" min="0.0" class="form-control form-control-lg border-right-0 pr-0" aria-describedby="percent of collateralization target" placeholder="0.0" id="collateral-ratio-target-input" (input)="continueEnabled = true">
                  <div class="input-group-append">
                    <span class="input-group-text border-left-0 border-right-0" id="desiredCollateralizationUnit">%</span>
                    <button class="btn btn-white" name="button" type="button" *ngIf="sellData.currCash.lt(sellData.currBorrow)" (click)="maxTopupTarget()">Max</button>
                  </div>
                </div>
                <small id="kroBalance" class="form-text text-secondary d-inline-block mb-0 mt-1" *ngIf="sellData.currCash.lt(sellData.currBorrow)">{{sellData.currCollateral.div(sellData.currBorrow.minus(sellData.currCash)).times(100).toFormat(0)}}% • Max possible collateral ratio</small>
              </form>
            </div>
          </div>
        </div>

        <!--Step 1: confirm tx in wallet-->
        <!-- Confirm tx body -->
        <p class="text-center text-muted mb-5" *ngIf="topupPopupStep === 1">
          Confirm the transaction in your wallet’s interface to save it on the Ethereum blockchain. It's fine to stick with these defaults gas limit and price.
        </p>

        <!--Step 2: tx broadcasted-->
        <div *ngIf="topupPopupStep == 2">
          <!-- loader -->
          <img class="image-fluid d-block mx-auto mb-4" src="assets/img/animated-logo.svg" alt="Betoken logo" style="width: 88px;">
          <!-- Tx broadcasted body -->
          <p class="text-center text-muted mb-5">
            Your transaction is being saved on the Ethereum blockchain. You can check its status on Etherscan.
          </p>
        </div>

        <!--Step 3: tx confirmed-->
        <!-- Asset sold body -->
        <div *ngIf="topupPopupStep == 3">
          <p class="h1 text-center">
            <i class="fe fe-check-circle text-success"></i>
          </p>
          <p class="text-center text-muted mb-5">
            You have successfully topped up the order.
          </p>
        </div>

        <hr *ngIf="topupPopupStep === 2 || topupPopupStep === 3">
        <form *ngIf="topupPopupStep === 2 || topupPopupStep === 3">
          <div class="form-group">
            <label>Transaction ID</label>
            <div class="input-group mb-3">
              <input type="text" class="form-control form-control-lg" value="{{transactionId}}" aria-label="Transaction ID" aria-describedby="">
              <div class="input-group-append">
                <a class="btn btn-white h-100 d-flex align-items-center" href="https://etherscan.io/tx/{{transactionId}}" target="_blank"><i class="fe fe-external-link"></i></a>
              </div>
            </div>
          </div>
        </form>

        <!-- Continue button for amount to sell Step -->
        <button type="submit" class="btn btn-block btn-success mt-auto" aria-label="Topup" (click)="topup()" *ngIf="topupPopupStep === 0" [disabled]="!continueEnabled">
          Continue
        </button>
        <!-- close button panel after Asset being sold -->
        <button type="submit" class="btn btn-block btn-white mt-auto" data-dismiss="modal" aria-label="Close" *ngIf="topupPopupStep === 3">
          Close
        </button>
      </div>
    </div>
  </div>
</div><!-- / modal -->
